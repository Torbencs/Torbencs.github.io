<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
    <title>Babylon - Getting Started</title>
    <!--- Link to the last version of BabylonJS --->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.babylonjs.com/cannon.js"></script>
    
    <style>
        html, body {
            overflow: hidden;
            width   : 100%;
            height  : 100%;
            margin  : 0;
            padding : 0;
        }

        #renderCanvas {
            width   : 100%;
            height  : 100%;
            touch-action: none;
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        window.addEventListener('DOMContentLoaded', function(){
            // get the canvas DOM element
            var canvas = document.getElementById('renderCanvas');

            // load the 3D engine
            var engine = new BABYLON.Engine(canvas, true);

            // createScene function that creates and return the scene
            var createScene = function(){
                // create a basic BJS Scene object
                var scene = new BABYLON.Scene(engine);

                //Physics
                var gravityVector = new BABYLON.Vector3(-0.01,-.7, 0);
                var physicsPlugin = new BABYLON.CannonJSPlugin();
                scene.enablePhysics(gravityVector, physicsPlugin);

                // create a FreeCamera, and set its position to (x:0, y:5, z:-10)
                var camera = new BABYLON.ArcRotateCamera("Camera", Math.PI * 1.5, Math.PI /4, 1.3, new BABYLON.Vector3(0, 0, 0), scene);

                // target the camera to scene origin
                camera.setTarget(BABYLON.Vector3.Zero());

                // attach the camera to the canvas
                camera.attachControl(canvas, true);

                // create a basic light, aiming 0,1,0 - meaning, to the sky
                //var light = new BABYLON.HemisphericLight('light1', new BABYLON.Vector3(0,1,0), scene);
                // var light = new BABYLON.SpotLight("spotLight", new BABYLON.Vector3(4, 8, 4), new BABYLON.Vector3(0, -0.5, 0), Math.PI / 3, 10, scene);
                
                var light2 = new BABYLON.SpotLight("light2", new BABYLON.Vector3(0.5, 1, 0), new BABYLON.Vector3(-1,-1,0), 4, 10, scene);
                //var light1 = new BABYLON.SpotLight("light1", new BABYLON.Vector3(1, 1, 0), new BABYLON.Vector3(-2,-2,0), 4, 10, scene);
	            light2.intensity = 0.7;
	            

                var lightSphere1 = BABYLON.Mesh.CreateSphere("sphere", 10, 0.3, scene);
                lightSphere1.position = light2.position;
                lightSphere1.material = new BABYLON.StandardMaterial("light2", scene);
                lightSphere1.material.emissiveColor = new BABYLON.Color3(1, 1, 0);
                
                //Shadows
                var shadowGenerator = new BABYLON.ShadowGenerator(1024, light2);
                /*var light2 = new BABYLON.DirectionalLight("dir01", new BABYLON.Vector3(1, -2, 1), scene);
	            light.position = new BABYLON.Vector3(2, 4, 2);
	            light.intensity = 1;
                */
                // create a built-in "sphere" shape; its constructor takes 6 params: name, segment, diameter, scene, updatable, sideOrientation 
                var sphere = BABYLON.Mesh.CreateSphere('sphere1', 8, .03, scene);
                sphere.physicsImpostor = new BABYLON.PhysicsImpostor(sphere, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0.1 }, scene);
                // move the sphere upward 1/2 of its height
                sphere.position.y = 1;
                sphere.position.x = 0.03;
                shadowGenerator.getShadowMap().renderList.push(sphere);
                sphere.receiveShadows = true;
            

                //Import Model
            
                BABYLON.SceneLoader.ImportMesh("", "", "A.babylon", scene, function (mesh) {
                    camera.target = mesh[0];

                    let curve = mesh[0];
                    curve.physicsImpostor = new BABYLON.PhysicsImpostor(curve, BABYLON.PhysicsImpostor.MeshImpostor, {mass: 0, friction: 0, restitution: 0.1});

                     //Shadows
                    shadowGenerator.getShadowMap().renderList.push(curve);
                    curve.receiveShadows = true;

                })
                
                
               
                
                
                //ground.physicsImpostor = new BABYLON.PhysicsImpostor(ground, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.1 }, scene);
                

                // return the created scene
                return scene;
            }

            // call the createScene function
            var scene = createScene();

            // run the render loop
            engine.runRenderLoop(function(){
                scene.render();
            });

            // the canvas/window resize event handler
            window.addEventListener('resize', function(){
                engine.resize();
            });
        });
    </script>
</body>
</html>